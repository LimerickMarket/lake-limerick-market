<%= form_with(model: [:admin, template], local: true, class: "needs-validation") do |f| %>
  <% if template.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(template.errors.count, "error") %> prohibited this template from being saved:</h4>
      <ul>
        <% template.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="card">
    <div class="card-body">
      <div class="mb-3">
        <%= f.label :name, "Template Name", class: "form-label" %>
        <%= f.text_field :name, class: "form-control", 
            placeholder: "e.g., Weekly Deals Newsletter", required: true %>
        <small class="form-text text-muted">Internal name for this template</small>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <%= f.label :template_type, "Newsletter Type", class: "form-label" %>
          <%= f.select :template_type, 
              NewsletterTemplate::TEMPLATE_TYPES.map { |k, v| [v, k] },
              { prompt: "Select type" },
              { class: "form-select", required: true } %>
          <small class="form-text text-muted">Choose which subscribers will receive this</small>
        </div>

        <div class="col-md-6 mb-3">
          <%= f.label :cadence, "Send Frequency", class: "form-label" %>
          <%= f.select :cadence,
              NewsletterTemplate::CADENCES.map { |k, v| [v, k] },
              {},
              { class: "form-select", required: true } %>
          <small class="form-text text-muted">How often to send automatically</small>
        </div>
      </div>

      <div class="mb-3">
        <%= f.label :subject, "Email Subject Line", class: "form-label" %>
        <%= f.text_field :subject, class: "form-control", 
            placeholder: "e.g., This Week's Special Deals at Limerick Market!", required: true %>
        <small class="form-text text-muted">This appears in the subscriber's inbox</small>
      </div>

      <div class="mb-3">
        <%= f.label :body, "Email Body", class: "form-label" %>
        <%= f.text_area :body, class: "form-control", rows: 15, 
            placeholder: "Write your email content here. You can use HTML for formatting.\n\nExample:\n<h2>This Week's Deals</h2>\n<p>Check out our amazing offers...</p>", 
            required: true %>
        <small class="form-text text-muted">
          HTML is supported. Use placeholders: 
          <code>{{subscriber_name}}</code>, 
          <code>{{unsubscribe_link}}</code>
        </small>
      </div>

      <div class="mb-3">
        <div class="form-check form-switch">
          <%= f.check_box :active, class: "form-check-input", id: "active-switch", checked: template.active? %>
          <%= f.label :active, "Active (template can be sent)", class: "form-check-label", for: "active-switch" %>
        </div>
      </div>

      <div class="alert alert-info">
        <strong>ðŸ’¡ Tips:</strong>
        <ul class="mb-0">
          <li>Use HTML for rich formatting (headings, links, images, etc.)</li>
          <li>Keep subject lines under 50 characters for best open rates</li>
          <li>Test your template with the Preview button before sending</li>
          <li>Manual cadence requires clicking "Send Now" each time</li>
        </ul>
      </div>

      <div class="d-flex gap-2">
        <%= f.submit template.new_record? ? "Create Template" : "Update Template", 
            class: "btn btn-primary" %>
        <%= link_to "Cancel", admin_newsletter_templates_path, class: "btn btn-secondary" %>
      </div>
    </div>
  </div>
<% end %>
